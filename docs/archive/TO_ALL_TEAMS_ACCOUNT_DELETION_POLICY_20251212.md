# 계정 탈퇴 시 데이터 처리 정책 논의

**작성일**: 2025-12-12  
**작성팀**: Orchestrator Team  
**상태**: 📋 논의 필요

---

## 🤔 질문 배경

사용자가 K-Auth에서 계정 탈퇴를 요청할 경우, 각 서비스(Orchestrator, MCPHub)에서 관련 데이터를 어떻게 처리해야 하는지에 대한 정책이 필요합니다.

---

## 📊 서비스별 사용자 데이터 현황

### K-Auth (Identity Provider)
| 데이터 | 삭제 여부 | 비고 |
|--------|:--------:|------|
| 사용자 계정 (username, email, password) | ✅ 삭제 | 핵심 개인정보 |
| OAuth 클라이언트 연결 정보 | ✅ 삭제 | |
| 로그인 히스토리 | ⚠️ 익명화 | 보안 감사용 |

### Orchestrator
| 데이터 | 삭제 여부 | 비고 |
|--------|:--------:|------|
| 사용자 계정 (users 테이블) | ✅ 삭제 | kauth_user_id 기준 |
| 대화 이력 (conversations 테이블) | ⚠️ 익명화 | **분석용 보존** |
| 프롬프트 내용 (messages 테이블) | ⚠️ 익명화 | **분석용 보존** |
| 에이전트 선호 설정 | ✅ 삭제 | |
| MCP 토큰 (암호화) | ✅ 삭제 | 보안상 필수 |

### MCPHub
| 데이터 | 삭제 여부 | 비고 |
|--------|:--------:|------|
| 사용자 계정 | ✅ 삭제 | kauthUserId 기준 |
| MCPHub Keys | ✅ 삭제 | API 키 |
| 서비스 토큰 (Jira, GitHub 등) | ✅ 삭제 | 보안상 필수 |
| 서버 구독 정보 | ✅ 삭제 | |
| 사용 로그 | ⚠️ 익명화 | 통계용 |

---

## 🎯 제안: 데이터 보존 정책

### 1. 반드시 삭제해야 할 데이터 (개인정보)
- 사용자 계정 정보 (email, username, password_hash)
- 서비스 토큰 (외부 API 키)
- API 키 (MCPHub Keys)
- OAuth 연결 정보

### 2. 익명화하여 보존할 데이터 (분석용)
- **프롬프트/대화 내용** → `user_id = null` 또는 `user_id = "deleted_user_{hash}"`
- **에이전트 사용 통계** → 어떤 에이전트가 얼마나 사용되었는지
- **에러 로그** → 서비스 개선용

### 3. 완전 삭제할 데이터
- 개인 설정 (테마, 언어 등)
- 에이전트 선호도 설정

---

## 🔄 탈퇴 프로세스 제안

```
┌─────────────────────────────────────────────────────────────────┐
│                    계정 탈퇴 프로세스 (제안)                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  1. 사용자가 K-Auth에서 계정 탈퇴 요청                           │
│      ↓                                                          │
│  2. K-Auth가 Webhook 또는 이벤트 발송                            │
│      │ Event: user.deleted                                      │
│      │ Payload: { kauth_user_id: "uuid-xxx" }                   │
│      ↓                                                          │
│  3. Orchestrator                                                │
│      │ a. 서비스 토큰 삭제                                       │
│      │ b. 사용자 계정 삭제 또는 비활성화                         │
│      │ c. 대화 이력 익명화 (user_id = null)                      │
│      ↓                                                          │
│  4. MCPHub                                                      │
│      │ a. MCPHub Keys 삭제                                      │
│      │ b. 서비스 토큰 삭제                                       │
│      │ c. 사용자 계정 삭제                                       │
│      │ d. 서버 구독 해제                                         │
│      ↓                                                          │
│  5. 탈퇴 완료 (30일 유예 기간 가능)                              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📝 프롬프트 데이터 보존 이유

사용자가 입력한 프롬프트 데이터는 다음 목적으로 **익명화하여 보존**할 가치가 있습니다:

1. **서비스 개선**
   - 자주 실패하는 쿼리 패턴 분석
   - 에이전트 라우팅 정확도 개선

2. **모델 학습 데이터**
   - Fine-tuning용 데이터셋 구축
   - 프롬프트 최적화 연구

3. **통계 및 리포팅**
   - 에이전트별 사용량 분석
   - 트렌드 파악

**단, 개인을 특정할 수 있는 정보는 반드시 제거해야 합니다.**

---

## 🔒 GDPR/개인정보보호법 고려사항

| 원칙 | 적용 방안 |
|------|----------|
| 정보주체의 권리 | 탈퇴 요청 시 30일 내 처리 |
| 최소 수집 | 필요한 데이터만 수집 |
| 목적 제한 | 익명화된 데이터는 통계/분석 목적으로만 사용 |
| 보관 기한 | 탈퇴 후 익명화 데이터는 2년 보관 후 삭제 |

---

## ❓ 각 팀에 질문

### MCPHub 팀
1. 사용자 탈퇴 시 MCPHub Keys 즉시 삭제 vs 유예기간?
2. 서비스 토큰은 어떻게 처리?
3. Webhook 수신 엔드포인트 구현 가능?

### Agent 팀
1. Agent 측에 저장하는 사용자별 데이터가 있는지?
2. 캐시된 사용자 정보 처리 방안?

### K-Auth 팀 (Orchestrator 내부)
1. 탈퇴 시 Webhook 발송 기능 구현?
2. 30일 유예 기간 적용?
3. 탈퇴 전 데이터 다운로드 기능 필요?

---

## 📋 다음 단계

1. 각 팀 검토 및 의견 제시
2. 데이터 보존 정책 최종 확정
3. 탈퇴 API 및 Webhook 구현
4. 테스트 및 검증

---

**피드백 요청**: 각 팀에서 의견 및 추가 고려사항 문서로 공유 부탁드립니다.

---

*Orchestrator Team*  
*2025-12-12*

